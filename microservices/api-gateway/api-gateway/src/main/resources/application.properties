# ========================================
# SERVER CONFIGURATION
# ========================================
server.port=8080

# ========================================
# APPLICATION NAME
# ========================================
spring.application.name=api-gateway

# ========================================
# EUREKA CLIENT CONFIGURATION
# ========================================
eureka.client.service-url.defaultZone=http://localhost:8761/eureka/
eureka.client.register-with-eureka=true
eureka.client.fetch-registry=true
eureka.instance.prefer-ip-address=true
eureka.instance.instance-id=${spring.application.name}:${server.port}

# ========================================
# GATEWAY DISCOVERY (Auto-routing)
# ========================================
spring.cloud.gateway.discovery.locator.enabled=true
spring.cloud.gateway.discovery.locator.lower-case-service-id=true

# ========================================
# GATEWAY ROUTES CONFIGURATION
# ========================================

# Dashboard Route (Local Controller)
spring.cloud.gateway.routes[0].id=dashboard-route
spring.cloud.gateway.routes[0].uri=forward:/
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/dashboard/**

# Room Service
spring.cloud.gateway.routes[1].id=room-service
spring.cloud.gateway.routes[1].uri=lb://room-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/rooms/**

# Booking Service
spring.cloud.gateway.routes[2].id=booking-service
spring.cloud.gateway.routes[2].uri=lb://booking-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/bookings/**

# Customer Service
spring.cloud.gateway.routes[3].id=customer-service
spring.cloud.gateway.routes[3].uri=lb://customer-service
spring.cloud.gateway.routes[3].predicates[0]=Path=/api/customers/**

# Billing Service (Corrigé: billing-service en minuscules)
spring.cloud.gateway.routes[4].id=billing-service
spring.cloud.gateway.routes[4].uri=lb://billing-service
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/billing/**

# ========================================
# TIMEOUT CONFIGURATION
# ========================================
spring.cloud.gateway.httpclient.connect-timeout=5000
spring.cloud.gateway.httpclient.response-timeout=10s

# ========================================
# ACTUATOR CONFIGURATION
# ========================================
# Exposer tous les endpoints (ou spécifier ceux nécessaires)
management.endpoints.web.exposure.include=*
management.endpoints.web.base-path=/actuator

# Activer explicitement l'endpoint gateway
management.endpoint.gateway.enabled=true
management.endpoint.health.enabled=true
management.endpoint.health.show-details=always
management.endpoint.metrics.enabled=true
management.endpoint.prometheus.enabled=true

# ✅ IMPORTANT: Activer les endpoints spécifiques du Gateway
spring.cloud.gateway.actuator.verbose.enabled=true

# Metrics
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=${spring.application.name}

# ========================================
# CORS CONFIGURATION
# ========================================
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedOrigins=http://localhost:4200,http://localhost:50098
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedMethods=GET,POST,PUT,DELETE,OPTIONS,PATCH
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowedHeaders=*
spring.cloud.gateway.globalcors.cors-configurations.[/**].allowCredentials=true
spring.cloud.gateway.globalcors.cors-configurations.[/**].maxAge=3600

# ========================================
# RABBITMQ CONFIGURATION
# ========================================
rabbitmq.queue.billing=billing.queue

# ========================================
# LOGGING CONFIGURATION
# ========================================
logging.level.root=INFO
logging.level.com.hotel.demapi_gatewayo=DEBUG
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.org.springframework.cloud.loadbalancer=DEBUG
logging.level.org.springframework.web.reactive=DEBUG